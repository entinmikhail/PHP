
В данном разделе описывается работа с неразобранным через API.


### Оглавление  
- [Общая информация](#common-info)
- [Список неразобранного](#unsorted-list)
- [Получение неразобранного по UID](#unsorted-detail)
- [Добавление неразобранного типа звонок](#unsorted-add-sip)
- [Добавление неразобранного типа форма](#unsorted-add-form)
- [Принятие неразобранного](#unsorted-accept)
- [Отклонение неразобранного](#unsorted-decline)
- [Привязка неразобранного](#unsorted-link)
- [Сводная информация о неразобранных сделках](#unsorted-summary)
- [Описание объектов metadata](#metadata-description)

<a name="common-info"></a>

### Общая информация

*   Неразобранное является системный статус воронки сделок, который имеет дополнительные возможности
*   Задача данного статуса – накапливать лиды из разных источников для их разбора менеджерами
*   У неразобранного есть несколько категорий - чаты, формы, звонки, почта
*   Через API доступны для создания только 2 типа неразобранного: формы и звонки
*   Неразобранное типа чаты и почта добавляются встроенными средствами (интеграция с чатами и почтой)
*   При создании неразобранной сделки, можно передать данные о контакте, компании и метаданные (например: звонок, информацию о форме)
*   До принятия неразобранной сделки, контакты и компании недоступны в соответствующих разделах
*   В неразобранном не может оказаться 2 одинаковых сущности, в случае попытки уже добавленных ранее данных, вы получите ошибку
*   Неразобранное может быть принято, отклонено, а также привязано к существующей сделке или покупателю. Привязывать можно только неразобранное типа Чат

<a name="unsorted-list"></a>

### Список неразобранного 
#### Метод<br>
*GET /api/v4/leads/unsorted*<br>  
#### Описание<br>
Метод позволяет получить список неразобранного в аккаунте.  
#### Ограничения<br>
Метод доступен в соответствии с правами пользователя.    
#### GET параметры<br>

| Параметр | Тип данных | Описание |
|---|---|---|
| page | int | Страница выборки |
| limit | int | Количество возвращаемых сущностей за один запрос (Максимум – 250) |
| filter | object | Фильтр |
| filter[uid] | string\|array | Фильтр по UID неразобранного. Можно передать как один UID, так и массив из нескольких UID |
| filter[category] | array | Массив, содержащий в себе категории, по которым необходима выборка (sip, mail, forms, chats) |
| filter[pipeline_id] | int | Фильтр по ID воронки |
| order | object | Сортировка результатов списка.<br> Доступные поля для сортировки: created_at, updated_at.<br> Доступные значения для сортировки: asc, desc.<br> Пример: /api/v4/tasks?order[created_at]=asc |

#### Пример запроса<br>
В следующем примере мы получим список с одним неразобранным.

```json
https://example.amocrm.ru/api/v4/leads/unsorted?filter[uid]=98fb033cefde74f5de1a5d3980a2a2d108037
```
#### Заголовок типа данных при успешном результате<br>
*Content-Type: application/hal+json*<br>
#### Заголовок типа данных при ошибке<br>
*Content-Type: application/problem+json*
#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|    
| 200 | Запрос выполнен успешно | 
| 401 | Пользователь не авторизован | 

#### Параметры ответа<br>
Метод возвращает коллекцию моделей неразобранного, рассмотрим ниже свойства модели.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|uid|string|UID неразобранного|  
|source_uid|string|UID источника заявки, генерируется на стороне интеграции|  
|source_name|string|Название источника заявки|  
|category|string|Категория неразобранного. Один из вариантов: sip, mail, chats, forms|  
|pipeline_id|int|ID воронки, в которой находится неразобранное|  
|created_at|int|Дата создания неразобранного в Unix Timestamp|  
|metadata|object|Метаданные заявки, каждый тип заявки имеет свой набор данных. Подробней <a href="#metadata-description">тут</a>|  
|account_id|int|ID аккаунта, в котором находится неразобранное|  
|_embedded|object|Данные вложенных сущностей.|  
|_embedded[contacts]|array|Данные связанного с неразобранным контакта. В данный момент в массиве всегда 1 объект|  
|_embedded[contacts][0]|object|Модель контакта|  
|_embedded[contacts][0][id]|int|ID контакта|  
|_embedded[companies]|array|Данные связанной с неразобранным компании. В массиве всегда 1 объект|  
|_embedded[companies][0]|object|Модель компании|  
|_embedded[companies][0][id]|int|ID компании|  
|_embedded[leads]|array|Данные сделки. Так как неразобранное является сделка, то оно связано со сделкой. В массиве всегда 1 объект|  
|_embedded[leads][0]|object|Модель сделки|  
|_embedded[leads][0][id]|int|ID сделки|  

#### Пример ответа<br>
```json
{
    "_page": 1,
    "_links": {
        "self": {
            "href": "https://example.amocrm.ru/api/v4/leads/unsorted?filter[uid]=98fb033cefde74f5de1a5d3980a2a2d108037"
        }
    },
    "_embedded": {
        "unsorted": [
            {
                "uid": "98fb033cefde74f5de1a5d3980a2a2d108037",
                "source_uid": null,
                "source_name": "UIS",
                "category": "sip",
                "pipeline_id": 2194576,
                "created_at": 1583156937,
                "metadata": {
                    "from": "7999999999",
                    "phone": 7999999999,
                    "called_at": 1583156916,
                    "duration": "0",
                    "link": null,
                    "service_code": "uis_widget"
                },
                "account_id": 123312,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/unsorted/98fb033cefde74f5de1a5d3980a2a2d108037"
                    }
                },
                "_embedded": {
                    "contacts": [
                        {
                            "id": 13176707,
                            "_links": {
                                "self": {
                                    "href": "https://example.amocrm.ru/api/v4/contacts/13176707"
                                }
                            }
                        }
                    ],
                    "leads": [
                        {
                            "id": 7002787,
                            "_links": {
                                "self": {
                                    "href": "https://example.amocrm.ru/api/v4/leads/7002787"
                                }
                            }
                        }
                    ],
                    "companies": []
                }
            }
        ]
    }
}
```
<a name="unsorted-detail"></a>

### Получение неразобранного по UID 
#### Метод<br>
*GET /api/v4/leads/unsorted/{uid}*<br>  
#### Описание<br>
Метод позволяет получить данные конкретного неразобранного по UID.  
#### Ограничения<br>
Метод доступен в соответствии с правами пользователя.    
#### Заголовок типа данных при успешном результате<br>
*Content-Type: application/hal+json*<br>
#### Заголовок типа данных при ошибке<br>
*Content-Type: application/problem+json*
#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|    
| 200 | Запрос выполнен успешно | 
| 401 | Пользователь не авторизован | 

#### Параметры ответа<br>
Метод возвращает модель неразобранного, рассмотрим ниже её свойства.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|uid|string|UID неразобранного|  
|source_uid|string|UID источника заявки, генерируется на стороне интеграции|  
|source_name|string|Название источника заявки|  
|category|string|Категория неразобранного. Один из вариантов: sip, mail, chats, forms|  
|pipeline_id|int|ID воронки, в которой находится неразобранное|  
|created_at|int|Дата создания неразобранного в Unix Timestamp|  
|metadata|object|Метаданные заявки, каждый тип заявки имеет свой набор данных. Подробней <a href="#metadata-description">тут</a>|  
|account_id|int|ID аккаунта, в котором находится неразобранное|  
|_embedded|object|Данные вложенных сущностей.|  
|_embedded[contacts]|array|Данные связанного с неразобранным контакта. В данный момент в массиве всегда 1 объект|  
|_embedded[contacts][0]|object|Модель контакта|  
|_embedded[contacts][0][id]|int|ID контакта|  
|_embedded[companies]|array|Данные связанной с неразобранным компании. В массиве всегда 1 объект|  
|_embedded[companies][0]|object|Модель компании|  
|_embedded[companies][0][id]|int|ID компании|  
|_embedded[leads]|array|Данные сделки. В массиве всегда 1 объект|  
|_embedded[leads][0]|object|Модель сделки|  
|_embedded[leads][0][id]|int|ID сделки|  

#### Пример ответа<br>
```json
{
    "uid": "aa401affb0094076b7449008363c1dc77d6790ad13fb5b08176dc46daa18",
    "source_uid": "my_unique_uid",
    "source_name": "Название источника",
    "category": "forms",
    "pipeline_id": 3166396,
    "created_at": 1588840852,
    "metadata": {
        "form_id": "my_best_form",
        "form_name": "Обратная связь",
        "form_page": "https://example.com/form",
        "ip": "192.168.0.1",
        "form_sent_at": "1570178452",
        "referer": "https://google.com/search",
        "visitor_uid": null
    },
    "account_id": 28805383,
    "_links": {
        "self": {
            "href": "https://example.amocrm.ru/api/v4/leads/unsorted/aa401affb0094076b7449008363c1dc77d6790ad13fb5b08176dc46daa18"
        }
    },
    "_embedded": {
        "contacts": [
            {
                "id": 9567221,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/contacts/9567221"
                    }
                }
            }
        ],
        "leads": [
            {
                "id": 6414851,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/6414851"
                    }
                }
            }
        ],
        "companies": []
    }
}
```
<a name="unsorted-add-sip"></a>

### Добавление неразобранного типа звонок 
#### Метод<br>
*POST /api/v4/leads/unsorted/sip*<br>  
#### Описание<br>
Метод позволяет добавлять неразобранное в аккаунт пакетно.  
#### Ограничения<br>
Метод доступен в соответствии с правами пользователя.    
#### Заголовок запроса<br>
*Content-Type: application/json*
#### Параметры запроса<br>
Важно отметить, что передаваемый звонок должен быть входящим, потому что исходящий звонок всегда инициирован сотрудником компании, то есть он не нуждается в разборе.
Все поля, кроме created_at, pipeline_id являются обязательными.  

| Параметр | Тип данных | Описание |
|---|---|---|
| source_uid | string | UID источника заявки, генерируется на стороне интеграции |
| source_name | string | Название источника заявки |
| pipeline_id | int | ID воронки, в которой находится неразобранное |
| created_at | int | Дата создания неразобранного в Unix Timestamp |
| metadata | object | Метаданные заявки, каждый тип заявки имеет свой набор данных. Подробней <a href="#metadata-description">тут</a> |
| _embedded | object | Данные вложенных сущностей. |
| _embedded[contacts] | array | Данные связанного с неразобранным контакта. В данный момент в массиве всегда 1 объект |
| _embedded[contacts][0] | object | Модель контакта, соответствует той, что передается при [создании контакта](https://amocrm.ru/developers/content/crm_platform/contacts-api#contacts-add) |
| _embedded[companies] | array | Данные связанной с неразобранным компании. В массиве всегда 1 объект |
| _embedded[companies][0] | object | Модель компании, соответствует той, что передается при [создании компании](https://amocrm.ru/developers/content/crm_platform/companies-api#companies-add) |
| _embedded[leads] | array | Данные сделки. Так как неразобранное является сделка, то оно связано со сделкой. В массиве всегда 1 объект |
| _embedded[leads][0] | object | Модель сделки, соответствует той, что передается при [создании сделки](https://amocrm.ru/developers/content/crm_platform/leads-api#leads-add) |
| request_id | string | Поле, которое вернется вам в ответе без изменений и не будет сохранено. Параметр не является обязательным |

#### Пример запроса<br>


```json
[
    {
        "request_id": "123",
        "source_name": "ОАО Коспромсервис",
        "source_uid": "a1fee7c0fc436088e64ba2e8822ba2b3",
        "pipeline_id": 2194576,
        "created_at": 1510261200,
        "_embedded": {
            "leads": [
                {
                    "name": "Тех обслуживание",
                    "price": 5000,
                    "custom_fields_values": [
                        {
                            "field_id": 284785,
                            "values": [
                                {
                                    "value": "Кастомное поле"
                                }
                            ]
                        }
                    ],
                    "_embedded": {
                        "tags": [
                            {
                                "id": 263809
                            }
                        ]
                    }
                }
            ],
            "contacts": [
                {
                    "name": "Контакт для примера"
                }
            ],
            "companies": [
                {
                    "name": "ОАО Коспромсервис"
                }
            ]
        },
        "metadata": {
            "is_call_event_needed": true,
            "uniq": "a1fe231cc88e64ba2e8822ba2b3ewrw",
            "duration": 54,
            "service_code": "CkAvbEwPam6sad",
            "link": "https://example.com",
            "phone": 79998888888,
            "called_at": 1510261200,
            "from": "onlinePBX"
        }
    }
]
```
#### Заголовок типа данных при успешном результате<br>
*Content-Type: application/hal+json*<br>
#### Заголовок типа данных при ошибке<br>
*Content-Type: application/problem+json*
#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|    
| 200 | Неразобранные заявки были успешно созданы | 
| 401 | Пользователь не авторизован | 
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа | 

#### Параметры ответа<br>
Метод возвращает коллекцию неразобранных заявок, которые были созданы.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|uid|string|UID неразобранного|  
|account_id|int|ID аккаунта|  
|_embedded|object|Данные вложенных сущностей.|  
|_embedded[contacts]|array|Данные связанного с неразобранным контакта. В данный момент в массиве всегда не более 1 объекта|  
|_embedded[contacts][0]|object|Модель контакта|  
|_embedded[contacts][0][id]|int|ID контакта|  
|_embedded[companies]|array|Данные связанной с неразобранным компании. В данный момент в массиве всегда не более 1 объекта|  
|_embedded[companies][0]|object|Модель компании|  
|_embedded[companies][0][id]|int|ID компании|  
|_embedded[leads]|array|Данные сделки. В массиве всегда 1 объект|  
|_embedded[leads][0]|object|Модель сделки|  
|_embedded[leads][0][id]|int|ID сделки|  
|request_id|string|Строка переданная при запросе или порядковый указатель, если параметр не передан|  

#### Пример ответа<br>
```json
{
    "_total_items": 1,
    "_embedded": {
        "unsorted": [
            {
                "uid": "aa401affb0094076b74442bc3f401d53e103f264d6668fd3ecfd5acef42f",
                "account_id": 28805383,
                "request_id": "123",
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/unsorted/aa401affb0094076b74442bc3f401d53e103f264d6668fd3ecfd5acef42f"
                    }
                },
                "_embedded": {
                    "contacts": [
                        {
                            "id": 11075541,
                            "_links": {
                                "self": {
                                    "href": "https://example.amocrm.ru/api/v4/contacts/11075541"
                                }
                            }
                        }
                    ],
                    "leads": [
                        {
                            "id": 7706509,
                            "_links": {
                                "self": {
                                    "href": "https://example.amocrm.ru/api/v4/leads/7706509"
                                }
                            }
                        }
                    ],
                    "companies": []
                }
            }
        ]
    }
}
```
<a name="unsorted-add-form"></a>

### Добавление неразобранного типа форма 
#### Метод<br>
*POST /api/v4/leads/unsorted/forms*<br>  
#### Описание<br>
Метод позволяет добавлять неразобранное в аккаунт пакетно.  
#### Ограничения<br>
Метод доступен в соответствии с правами пользователя.    
#### Заголовок запроса<br>
*Content-Type: application/json*
#### Параметры запроса<br>
Все поля, кроме created_at, pipeline_id являются обязательными.  

| Параметр | Тип данных | Описание |
|---|---|---|
| source_uid | string | UID источника заявки, генерируется на стороне интеграции |
| source_name | string | Название источника заявки |
| pipeline_id | int | ID воронки, в которой находится неразобранное |
| created_at | int | Дата создания неразобранного в Unix Timestamp |
| metadata | object | Метаданные заявки, каждый тип заявки имеет свой набор данных. Подробней <a href="#metadata-description">тут</a> |
| _embedded | object | Данные вложенных сущностей. |
| _embedded[contacts] | array | Данные связанного с неразобранным контакта. В данный момент в массиве всегда 1 объект |
| _embedded[contacts][0] | object | Модель контакта, соответствует той, что передается при [создании контакта](https://amocrm.ru/developers/content/crm_platform/contacts-api#contacts-add) |
| _embedded[companies] | array | Данные связанной с неразобранным компании. В массиве всегда 1 объект |
| _embedded[companies][0] | object | Модель компании, соответствует той, что передается при [cсоздании компании][https://amocrm.ru/developers/content/crm_platform/contacts-api#contacts-add) |
| _embedded[leads] | array | Данные сделки. Так как неразобранное является сделка, то оно связано со сделкой. В массиве всегда 1 объект |
| _embedded[leads][0] | object | Модель сделки, соответствует той, что передается при [создании сделки](https://amocrm.ru/developers/content/crm_platform/leads-api#leads-add) |
| request_id | string | Поле, которое вернется вам в ответе без изменений и не будет сохранено. Параметр не является обязательным |

#### Пример запроса<br>


```json
[
    {
        "request_id": "123",
        "source_name": "ОАО Коспромсервис",
        "source_uid": "a1fee7c0fc436088e64ba2e8822ba2b3",
        "pipeline_id": 2194576,
        "created_at": 1590830520,
        "_embedded": {
            "leads": [
                {
                    "name": "Тех обслуживание",
                    "visitor_uid": "5692210d-58d0-468c-acb2-dce7f93eef87",
                    "price": 5000,
                    "custom_fields_values": [
                        {
                            "field_id": 284785,
                            "values": [
                                {
                                    "value": "Дополнительное поле"
                                }
                            ]
                        }
                    ],
                    "_embedded": {
                        "tags": [
                            {
                                "name": "Тег для примера"
                            }
                        ]
                    }
                }
            ],
            "contacts": [
                {
                    "name": 234,
                    "first_name": "123213",
                    "last_name": 234,
                    "custom_fields_values": [
                        {
                            "field_code": "PHONE",
                            "values": [
                                {
                                    "value": "+7912321323"
                                }
                            ]
                        }
                    ]
                }
            ],
            "companies": [
                {
                    "name": "ОАО Коспромсервис"
                }
            ]
        },
        "metadata": {
            "ip": "123.222.2.22",
            "form_id": "a1fee7c0fc436088e64ba2e8822ba2b3ewrw",
            "form_sent_at": 1590830520,
            "form_name": "Форма заявки для полёта в космос",
            "form_page": "https://example.com",
            "referer": "https://www.google.com/search?&q=elon+musk"
        }
    }
]
```
#### Заголовок типа данных при успешном результате<br>
*Content-Type: application/hal+json*<br>
#### Заголовок типа данных при ошибке<br>
*Content-Type: application/problem+json*
#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|    
| 200 | Неразобранные заявки были успешно созданы | 
| 401 | Пользователь не авторизован | 
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа | 

#### Параметры ответа<br>
Метод возвращает коллекцию неразобранных заявок, которые были созданы.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|uid|string|UID неразобранного|  
|account_id|int|ID аккаунта|  
|_embedded|object|Данные вложенных сущностей.|  
|_embedded[contacts]|array|Данные связанного с неразобранным контакта. В данный момент в массиве всегда не более 1 объекта|  
|_embedded[contacts][0]|object|Модель контакта|  
|_embedded[contacts][0][id]|int|ID контакта|  
|_embedded[companies]|array|Данные связанной с неразобранным компании. В данный момент в массиве всегда не более 1 объекта|  
|_embedded[companies][0]|object|Модель компании|  
|_embedded[companies][0][id]|int|ID компании|  
|_embedded[leads]|array|Данные сделки. В массиве всегда 1 объект|  
|_embedded[leads][0]|object|Модель сделки|  
|_embedded[leads][0][id]|int|ID сделки|  
|request_id|string|Строка переданная при запросе или порядковый указатель, если параметр не передан|  

#### Пример ответа<br>
```json
{
    "_total_items": 1,
    "_embedded": {
        "unsorted": [
            {
                "uid": "69035fda95c38bf3a281e846652217aade38692a5cf9d2b312e3724f78bc",
                "account_id": 28805383,
                "request_id": "123",
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/unsorted/69035fda95c38bf3a281e846652217aade38692a5cf9d2b312e3724f78bc"
                    }
                },
                "_embedded": {
                    "contacts": [
                        {
                            "id": 11075543,
                            "_links": {
                                "self": {
                                    "href": "https://example.amocrm.ru/api/v4/contacts/11075543"
                                }
                            }
                        }
                    ],
                    "leads": [
                        {
                            "id": 7706511,
                            "_links": {
                                "self": {
                                    "href": "https://example.amocrm.ru/api/v4/leads/7706511"
                                }
                            }
                        }
                    ],
                    "companies": []
                }
            }
        ]
    }
}
```
<a name="unsorted-accept"></a>

### Принятие неразобранного 
#### Метод<br>
*POST /api/v4/leads/unsorted/{uid}/accept*<br>  
#### Описание<br>
Метод позволяет принимать неразобранное.  
#### Ограничения<br>
Метод доступен в соответствии с правами пользователя.    
#### Заголовок запроса<br>
*Content-Type: application/json*
#### Параметры запроса<br>
Для принятия неразобранного нет обязательных параметров. Но можно дополнительно передать данные.  

| Параметр | Тип данных | Описание |
|---|---|---|
| user_id | int | ID пользователя, от имени которого будут созданы сущности |
| status_id | int | ID статуса, в котором окажется сделка после принятия неразобранного |

#### Пример запроса<br>
В примере ниже будет принято неразобранное запросом на метод /api/v4/leads/unsorted/{uid}/decline.
Неразобранное будет принято от имени пользователя с ID 123123.

```json
{
   "user_id": 123123,
   "status_id": 30846280
}
```
#### Заголовок типа данных при успешном результате<br>
*Content-Type: application/hal+json*<br>
#### Заголовок типа данных при ошибке<br>
*Content-Type: application/problem+json*
#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|    
| 200 | Задачи были успешно созданы | 
| 401 | Пользователь не авторизован | 
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа | 
| 404 | Неразобранное с указанным UID не найдено | 

#### Параметры ответа<br>
Метод возвращает модель принятого неразобранного и сущности, которые были созданы.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|uid|string|UID неразобранного|  
|category|string|Категория неразобранного. Один из вариантов: sip, mail, chats, forms|  
|pipeline_id|int|ID воронки, в которой находится неразобранное|  
|created_at|int|Дата создания неразобранного в Unix Timestamp|  
|_embedded|object|Данные вложенных сущностей.|  
|_embedded[contacts]|array|Данные связанного с неразобранным контакта. В данный момент в массиве всегда 1 объект|  
|_embedded[contacts][0]|object|Модель контакта|  
|_embedded[contacts][0][id]|int|ID контакта|  
|_embedded[companies]|array|Данные связанной с неразобранным компании. В массиве всегда 1 объект|  
|_embedded[companies][0]|object|Модель компании|  
|_embedded[companies][0][id]|int|ID компании|  
|_embedded[leads]|array|Данные сделки. В массиве всегда 1 объект|  
|_embedded[leads][0]|object|Модель сделки|  
|_embedded[leads][0][id]|int|ID сделки|  

#### Пример ответа<br>
```json
{
    "uid": "3cvd1de2ebfsd152fd6a465cd3e586cbdba6827",
    "pipeline_id": 31634,
    "category": "mail",
    "created_at": 1589165593,
    "_embedded": {
        "leads": [
            {
                "id": 9944789,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/9944789"
                    }
                }
            }
        ],
        "contacts": [
            {
                "id": 16522451,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/contacts/16522451"
                    }
                }
            }
        ],
        "companies": []
    }
}
```
<a name="unsorted-decline"></a>

### Отклонение неразобранного 
#### Метод<br>
*DELETE /api/v4/leads/unsorted/{uid}/decline*<br>  
#### Описание<br>
Метод позволяет отклонить неразобранное.  
#### Ограничения<br>
Метод доступен в соответствии с правами пользователя.    
#### Заголовок запроса<br>
*Content-Type: application/json*
#### Параметры запроса<br>
Для отклонения неразобранного нет обязательных параметров. Но можно дополнительно передать данные.  

| Параметр | Тип данных | Описание |
|---|---|---|
| user_id | int | ID пользователя, от имени которого будет произведено отклонение |

#### Пример запроса<br>


```json
{
   "user_id": 123123
}
```
#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|    
| 200 | Неразобранное было успешно удалено | 
| 403 | Не хватает прав для вызова данного метода | 
| 404 | Неразобранное с указанным UID не найдено | 
| 401 | Пользователь не авторизован | 
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа | 

#### Параметры ответа<br>
Метод возвращает модель отклоненного неразобранного и сущности, которые были перенесены в корзину.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|uid|string|UID неразобранного|  
|category|string|Категория неразобранного. Один из вариантов: sip, mail, chats, forms|  
|pipeline_id|int|ID воронки, в которой находится неразобранное|  
|created_at|int|Дата создания неразобранного в Unix Timestamp|  
|_embedded|object|Данные вложенных сущностей.|  
|_embedded[contacts]|array|Данные связанного с неразобранным контакта. В данный момент в массиве всегда 1 объект|  
|_embedded[contacts][0]|object|Модель контакта|  
|_embedded[contacts][0][id]|int|ID контакта|  
|_embedded[leads]|array|Данные сделки. В массиве всегда 1 объект|  
|_embedded[leads][0]|object|Модель сделки|  
|_embedded[leads][0][id]|int|ID сделки|  

#### Пример ответа<br>
```json
{
    "uid": "98bc1d1de2f960a2ad0e34b52823",
    "pipeline_id": 1394576,
    "category": "mail",
    "created_at": 1589115506,
    "_embedded": {
        "leads": [
            {
                "id": 9937533,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/9937533"
                    }
                }
            }
        ],
        "contacts": [
            {
                "id": 163141,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/contacts/163141"
                    }
                }
            }
        ]
    }
}
```
<a name="unsorted-link"></a>

### Привязка неразобранного 
#### Метод<br>
*POST /api/v4/leads/unsorted/{uid}/link*<br>  
#### Описание<br>
Метод позволяет принимать неразобранное.  
#### Ограничения<br>
*   Метод доступен с правами пользователя
*   Метод доступен только для неразобранного типа чат    
#### Заголовок запроса<br>
*Content-Type: application/json*
#### Параметры запроса<br>
Для привязки неразобранного необходимо передать обязательный объект с ключом link.  

| Параметр | Тип данных | Описание |
|---|---|---|
| user_id | int | ID пользователя, от имени которого будет выполнена привязка |
| link | object | Объект, содержащий информацию о сущности, к которой выполняется привязка |
| link[entity_id] | int | ID сущности, к которой выполняется привязка |
| link[entity_type] | string | Тип сущности. Доступные варианты: leads, customers |
| link[metadata] | object | Метаданные действия |
| link[metadata][contact_id] | int | ID контакта, к которому будет привязан контакт из неразобранного |

#### Пример запроса<br>


```json
{
    "link": {
        "entity_id": 93144801,
        "entity_type": "leads"
    }
}
```
#### Заголовок типа данных при успешном результате<br>
*Content-Type: application/hal+json*<br>
#### Заголовок типа данных при ошибке<br>
*Content-Type: application/problem+json*
#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|    
| 200 | Неразобранное было успешно привязано | 
| 401 | Пользователь не авторизован | 
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа | 

#### Параметры ответа<br>
Метод возвращает информацию о совершенном действие.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|uid|string|UID неразобранного|  
|_embedded|object|Данные вложенных сущностей.|  
|_embedded[{entity_type}]|array|Данные сущности, к которой выполнена привязка. В массиве всегда 1 объект|  
|_embedded[{entity_type}][0]|object|Модель сущности|  
|_embedded[{entity_type}][0][id]|int|ID сущности|  

#### Пример ответа<br>
```json
{
    "uid": "d7faa21ce091fe0da05d8d4c2075090c1e9bfd4",
    "_embedded": {
        "leads": [
            {
                "id": 93144801,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/93144801"
                    }
                }
            }
        ]
    }
}
```
<a name="unsorted-summary"></a>

### Сводная информация о неразобранных сделках 
#### Метод<br>
*GET /api/v4/leads/unsorted/summary*<br>  
#### Описание<br>
Метод позволяет получить сводную информацию о неразобранном в аккаунте.  
#### Ограничения<br>
Метод доступен в соответствии с правами пользователя.    
#### GET параметры<br>

| Параметр | Тип данных | Описание |
|---|---|---|
| filter | object | Фильтр |
| filter[uid] | string\|array | Фильтр по UID неразобранного. Можно передать как один UID, так и массив из нескольких UID |
| filter[created_at] | int\|object | Фильтр по дате создания и дате принятия неразобранного. Можно передать timestamp, в таком случае будут возвращены данные по неразобранным созданным и принятым c переданного timestamp. Также можно передать объект вида filter[created_at][from]=… и filter[created_at][to]=…, для фильтрации по значениям ОТ и ДО. |
| filter[pipeline_id] | int | Фильтр по ID воронки |

#### Пример запроса<br>


```json
https://example.amocrm.ru/api/v4/leads/unsorted/summary?filter[created_at][from]=1589176500&filter[created_at][to]=1589176560&filter[pipeline_id]=2194576
```
#### Заголовок типа данных при успешном результате<br>
*Content-Type: application/hal+json*<br>
#### Заголовок типа данных при ошибке<br>
*Content-Type: application/problem+json*
#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|    
| 200 | Запрос выполнен успешно | 
| 401 | Пользователь не авторизован | 

#### Параметры ответа<br>
Метод возвращает сводную информацию в виде объекта.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|total|int|Общее количество неразобранных заявок|  
|accepted|int|Общее количество принятых заявок|  
|declined|int|Общее количество отклоненных заявок|  
|average_sort_time|int|Среднее время разбора заявки в секундах|  
|categories|object|Количество неразобранных заявок находящихся в конкретной категории|  

#### Пример ответа<br>
```json
{
    "total": 168,
    "accepted": 6,
    "declined": 2,
    "average_sort_time": 34521,
    "categories": {
        "sip": {
            "total": 31
        },
        "mail": {
            "total": 41
        },
        "forms": {
            "total": 27
        },
        "chats": {
            "total": 69
        }
    }
}
```
<a name="metadata-description"></a>

### Описание объектов metadata

#### Метаданные неразобранного в категории sip (звонок)

| Параметр                | Тип данных | Описание              |
|-------------------------|------------|-----------------------|
| from                    | string     | От кого сделан звонок |
| phone                   | string     | Кому сделан звонок |
| called\_at              | int        | Когда сделан звонок в формате Unix Timestamp. |
| duration                | int        | Сколько длился звонок |
| link                    | string     | Ссылка на запись звонка |
| service\_code           | string     | Код сервиса, через который сделан звонок |
| is\_call\_event\_needed | bool       | Данный флаг не возвращается в API, но может быть передан. В случае передачи значения true, в карточку будет добавлено событие о входящем звонке. |

#### Метаданные неразобранного в категории forms (формы)

| Параметр       | Тип данных | Описание                                                                     |
|----------------|------------|------------------------------------------------------------------------------|
| form\_id       | string     | Идентификатор формы на стороне интеграции.                                   |
| form\_name     | string     | Название формы                                                               |
| form\_page     | string     | Страница, на которой установлена форма                                       |
| ip             | string     | IP адрес, с которого поступила заявка                                        |
| form\_sent\_at | int        | Временная метка отправки данных через форму. Данные в формате Unix Timestamp |
| referer        | string     | Информация, откуда был переход на страницу, где расположена форма.           |

#### Метаданные неразобранного в категории chat (чат)

| Параметр               | Тип данных   | Описание                                                              |
|------------------------|--------------|-----------------------------------------------------------------------|
| from                   | string       | Имя пользователя, который написал в чат                               |
| to                     | string       | Идентификатор страницы, на которую написано сообщение                 |
| received\_at           | int          | Когда получено сообщение от клиента. Данные в формате Unix Timestamp. |
| service                | string       | Название сервиса, из которого получено сообщение                      |
| client                 | object       | Данные об авторе сообщения                                            |
| client\[name\]         | string       | Имя отправителя сообщения                                             |
| client\[avatar\]       | string\|null | Ссылка на аватар отправителя сообщения                                |
| origin                 | object       | Данные об источнике сообщения                                         |
| origin\[chat\_id\]     | string       | ID чата в сервисе чатов                                               |
| origin\[ref\]          | string\|null | Дополнительные данные из сервиса чатов                                |
| origin\[visitor\_uid\] | string\|null | UID пользователя, который написал сообщение                           |
| last\_message\_text    | string\|null | Последнее сообщение от пользователя                                   |
| source\_name           | string       | Название источника, из которого получено сообщение                    |

#### Метаданные неразобранного в категории mail (почта)

| Параметр         | Тип данных | Описание                                                |
|------------------|------------|---------------------------------------------------------|
| from             | object     | Информация об авторе письма                             |
| from\[email\]    | string     | E-mail автора письма                                    |
| from\[name\]     | string     | Имя автора письма                                       |
| received\_at     | int        | Когда получено письмо. Данные в формате Unix Timestamp. |
| subject          | string     | Тема письма                                             |
| thread\_id       | int        | ID цепочки писем в сервисе почты                        |
| message\_id      | int        | ID письма в сервисе почты                               |
| content\_summary | string     | Выдержка из контента письма                             |



<!-- Generated at Thu, 04 Mar 2021 14:20:44 +0000. amoCRM Documentation Generator -->