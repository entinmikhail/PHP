
В данном разделе описывается работа с методом добавления звонков


<a name="common-info"></a>

### Общая информация

При использовании метода добавления звонков, система автоматически находит контакт или компанию с указанным номером телефона, а также все связанные сделки и покупатели и добавляет звонок в одну из них по следующему алгоритму:

*   если у контакта/компании есть одна активная сделка и нет связанных покупателей, то звонок будет добавлен в сделку
*   если у контакта/компании есть один покупатель и нет активных сделок, то звонок будет добавлен в покупателя
*   в случае если у контакта/компании более одной активной сделки/покупателя или связанные сущности отсутствуют, то звонок будет добавлен в карточку контакта/компании
*   поиск производится по последним 10 цифрам номера

<a name="calls-add"></a>

### Добавление звонка

#### Метод

*POST /api/v4/calls*

#### Описание 

Данный метод позволяет пакетно добавлять звонки в карточки сущностей.   
При добавлении звонков будет использоваться алгоритм описанный выше.    
При наличии в аккаунте карточки подходящей под условия алгоритма, звонок будет добавлен мгновенно.  
Если сущности с таким номером нет в базе, то звонок добавлен не будет.  

#### Ограничения 

Метод доступен в соответствии с правами пользователя.

#### Заголовок запроса 

*Content-Type: application/json*

#### Параметры запроса 




| Параметр | Тип данных | Описание |
|---|---|---|
| direction | string | Направление звонка. inbound - входящий, outbound - исходящий. Обязательный параметр |
| uniq | string | Уникальный идентификатор звонка. Необязательный параметр |
| duration | int | Длительность звонка в секундах. Обязательный параметр |
| source | string | Источник звонка. Обязательный параметр |
| link | string | Ссылка на запись звонка. Необязательный параметр |
| phone | string | Номер телефона, по которому будет произведен поиск. Обязательный параметр |
| call_result | string | Результат звонка. Необязательный параметр |
| call_status | int | Статус звонка. Доступные варианты: 1 - оставил сообщение, 2 - перезвонить позже, 3 - нет на месте, 4 - разговор состоялся, 5 - неверный номер, 6 - Не дозвонился, 7 - номер занят. Необязательный параметр |
| responsible_user_id | int | ID пользователя, ответственного за звонок |
| created_by | int | ID пользователя, создавший звонок |
| updated_by | int | ID пользователя, изменивший звонок |
| created_at | int | Дата создания звонка, передается в Unix Timestamp |
| updated_at | int | Дата изменения звонка, передается в Unix Timestamp |
| request_id | string | Поле, которое вернется вам в ответе без изменений и не будет сохранено. Необязательный параметр |

#### Пример запроса



```json
[
  {
    "duration": 10,
    "source": "example_integration",
    "phone": "123123",
    "link": "https://example.com/audio.mp3",
    "direction": "inbound",
    "call_result": "Успешный разговор",
    "call_status": 4
  }
]
```

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке 

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|
| 200 | Запрос выполнен успешно |
| 401 | Пользователь не авторизован |
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа |

#### Параметры ответа 

Метод возвращает коллекцию добавленных звонков, рассмотрим ниже свойства свойства звонка.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|id|int|ID добавленного примечания|
|entity_id|int|Тип сущности, в которую добавлен звонок|
|entity_type|int|ID сущности, в которую добавлен звонок|
|account_id|int|ID аккаунта, в который добавлен звонок|
|request_id|string|Поле, которое вернется вам в ответе без изменений и не будет сохранено. Параметр не является обязательным|
|_embedded|object|Данные вложенных сущностей|
|_embedded[entity]|object|Модель сущности, в которую добавлен звонок|
|_embedded[entity][id]|int|ID сущности, в которую добавлен звонок|

#### Пример ответа 

```json
{
    "_total_items": 1,
    "errors": [],
    "_embedded": {
        "calls": [
            {
                "id": 37512063,
                "entity_id": 11070881,
                "entity_type": "contact",
                "account_id": 28805383,
                "request_id": "0",
                "_embedded": {
                    "entity": {
                        "id": 11070881,
                        "_links": {
                            "self": {
                                "href": "https://example.amocrm.ru/api/v4/contacts/11070881"
                            }
                        }
                    }
                }
            }
        ]
    }
}
```
<!-- Generated at Thu, 04 Mar 2021 12:42:11 +0000. amoCRM Documentation Generator -->