
В данном разделе описывается работа со списком событий и примечаниями сущностей

### Оглавление  
- [Общая информация о событиях](#events-common-info)
- [Список событий](#events-list)
- [Получение события по ID](#events-detail)
- [Значения для фильтра по значению до/после](#events-filter-params)
- [Структуры данных в полях value_after и value_before](#events-params)
- [Типы событий](#events-types)
- [Получение типов событий](#event-types)
- [Общая информация о примечаниях](#notes-common-info)
- [Типы примечаний](#notes-types)
- [Список примечаний по типу сущности](#notes-list)
- [Список примечаний по конкретной сущности, по ID сущности](#notes-entity-list)
- [Получение примечания по ID](#note-detail)
- [Добавление примечаний](#notes-add)
- [Редактирование примечаний](#notes-edit)

<a name="events-common-info"></a>

### Общая информация о событиях

Список событий - это набор информации о происходящих действиях в вашем аккаунте. С помощью API списка событий вы можете получить информацию о различных действиях в аккаунте.

<a name="events-list"></a>

### Список событий

#### Метод

*GET /api/v4/events*

#### Описание 

Метод позволяет получить список событий.

#### Ограничения 

Метод доступен всем пользователям аккаунта. Возвращаемые данные зависят от прав на сущность.

#### GET параметры 


| Параметр | Тип данных | Описание |
|--|--|--|
| with | string | Данный параметр принимает строку, в том числе из нескольких значений, указанных через запятую. |
| page | int | Страница выборки |
| limit | int | Количество возвращаемых сущностей за один запрос (Максимум – 100) |
| filter | object | Фильтр |
| filter[id] | string|array | Фильтр по ID событий. Можно передать как один ID, так и массив из нескольких ID |
| filter[created_at] | int|array | Фильтр по дате создания события (когда оно произошло). Можно передать timestamp, в таком случае будут возвращены события, которые были созданы после переданного значения. Также можно передать массив вида filter[created_at][from]=… и filter[created_at][to]=…, для фильтрации по значениям ОТ и ДО. |
| filter[created_by] | int|array | Фильтр по пользователю, передаются до 10-ти ID пользователей, состоящих в аккаунте, в виде массива. Например, filter[created_by][]=956328&filter[created_by][]=504141 |
| filter[entity] | string|array | Фильтр по типу сущности, передаются в виде массива. Возможные параметры – lead, contact, company, customer, task, catalog_{CATALOG_ID}. Например, filter[entity][]=lead&filter[entity][]=contact&filter[entity][]=catalog_1075 |
| filter[entity_id] | int|array | Фильтр по ID сущности, передаются до 10-ти ID в виде массива. Для использования данного фильтра обязательна передача фильтра filter[entity] и не более 1 сущности в нём. Например, filter[entity]=lead&filter[entity_id][]=648533 |
| filter[type] | string|array | Фильтр по типу событий. Типы перечисляются в виде массива, <a href="#events-types">подробней о возможных типах</a> |
| filter[value_before] | string|array | Фильтр по значению до. Подробней о возможных значения и ограничениях читайте – <a href="#events-filter-params">тут</a> |
| filter[value_after] | string|array | Фильтр по значению до. Подробней о возможных значения и ограничениях читайте – <a href="#events-filter-params">тут</a> |

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке 

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|
| 200 | Запрос выполнен успешно |
| 401 | Пользователь не авторизован |
| 402 | Аккаунт не оплачен |

#### Параметры ответа 

Метод возвращает коллекцию моделей событий, рассмотрим ниже свойства события.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|id|string|ID события|
|type|string|Тип события|
|entity_id|int|ID сущности события|
|entity_type|string|Сущность события|
|created_by|int|ID пользователя, создавший событие|
|created_at|int|Дата создания события, передается в Unix Timestamp|
|value_after|array|Массив с изменениями по событию. Подробней о свойствах изменения читайте <a href="#events-params">тут</a>|
|value_before|array|Массив с изменениями по событию. Подробней о свойствах изменения читайте <a href="#events-params">тут</a>|
|account_id|int|ID аккаунта, в котором находится событие|

#### Пример ответа 

```json

{
    "_page": 1,
    "_links": {
        "self": {
            "href": "https://example.amocrm.ru/api/v4/events?limit=1&page=1"
        },
        "next": {
            "href": "http://asfasf24124214.nbessudnov.amocrm2.saas/api/v4/events?limit=1&page=2"
        }
    },
    "_embedded": {
        "events": [
            {
                "id": "01pz58t6p04ymgsgfbmfyfy1mf",
                "type": "lead_added",
                "entity_id": 26060763,
                "entity_type": "lead",
                "created_by": 939801,
                "created_at": 1888888888,
                "value_after": [
                    {
                        "note": {
                            "id": 42743871
                        }
                    }
                ],
                "value_before": [],
                "account_id": 17079858,
                "_links": {
                    "self": {
                        "href": "http://asfasf24124214.nbessudnov.amocrm2.saas/api/v4/events/01pz58t6p04ymgsgfbmfyfy1mf"
                    }
                },
                "_embedded": {
                    "entity": {
                        "id": 26060763,
                        "_links": {
                            "self": {
                                "href": "http://asfasf24124214.nbessudnov.amocrm2.saas/api/v4/leads/26060763"
                            }
                        }
                    }
                }
            }
        ]
    }
}

```

<a name="with-ae64a5c9-b973-455e-b41a-717d87666f6a-params"></a>

#### Параметры для GET-параметры with 

| Параметр | Описание |
|----------|----------|
| contact_name | Если сущностью события является контакт, то помимо его ID, вы получите и название |
| lead_name | Если сущностью события является сделка, то помимо её ID, вы получите и название |
| company_name | Если сущностью события является компания, то помимо её ID, вы получите и название |
| catalog_element_name | Если сущностью события является элемент каталога, то помимо его ID, вы получите и название |
| customer_name | Если сущностью события является покупатель, то помимо его ID, вы получите и название |
| catalog_name | Если сущностью события является элемент каталога, то помимо ID каталога, к которому он относится, вы получите и название каталога |

<a name="events-detail"></a>

### Получение события по ID

#### Метод

*GET /api/v4/events/{id}*

#### Описание 

Метод позволяет получить данные конкретного события по ID.

#### Ограничения 

Метод доступен всем пользователям аккаунта. Возвращаемые данные зависят от прав на сущность.

#### GET параметры 


| Параметр | Тип данных | Описание |
|--|--|--|
| with | string | Данный параметр принимает строку, в том числе из нескольких значений, указанных через запятую. |

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке 

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|
| 200 | Запрос выполнен успешно |
| 401 | Пользователь не авторизован |
| 402 | Аккаунт не оплачен |

#### Параметры ответа 

Метод возвращает модель события, рассмотрим ниже свойства события.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|id|string|ID события|
|type|string|Тип события|
|entity_id|int|ID сущности события|
|entity_type|string|Сущность события|
|created_by|int|ID пользователя, создавший событие|
|created_at|int|Дата создания события, передается в Unix Timestamp|
|value_after|array|Массив с изменениями по событию. Подробней о свойствах изменения читайте <a href="#events-params">тут</a>|
|value_before|array|Массив с изменениями по событию. Подробней о свойствах изменения читайте <a href="#events-params">тут</a>|
|account_id|int|ID аккаунта, в котором находится событие|

#### Пример ответа 

```json

{
    "id": "01pz58t6p04ymgsgfbmfyfy1mf",
    "type": "lead_added",
    "entity_id": 26060763,
    "entity_type": "lead",
    "created_by": 939801,
    "created_at": 1888888888,
    "value_after": [
        {
            "note": {
                "id": 42743871
            }
        }
    ],
    "value_before": [],
    "account_id": 17079858,
    "_links": {
        "self": {
            "href": "https://example.amocrm.ru/api/v4/events/01pz58t6p04ymgsgfbmfyfy1mf"
        }
    },
    "_embedded": {
        "entity": {
            "id": 26060763,
            "_links": {
                "self": {
                    "href": "https://example.amocrm.ru/api/v4/leads/26060763"
                }
            }
        }
    }
}

```

<a name="with-6dc69555-9201-4301-b643-5f8d43d3ee18-params"></a>

#### Параметры для GET-параметры with 

| Параметр | Описание |
|----------|----------|
| catalog_elements | Добавляет в ответ связанные со сделками элементы списков |
| is_price_modified_by_robot | Добавляет в ответ свойство, показывающее, изменен ли в последний раз бюджет сделки роботом |
| loss_reason | Добавляет в ответ расширенную информацию по причине отказа |
| contacts | Добавляет в ответ информацию о связанных со сделкой контактах |
| only_deleted | Если передать данный параметр, то в ответе на запрос метода, вернутся удаленные сделки, которые еще находятся в корзине. В ответ вы получите модель сделки, у которой доступны дату изменения, ID пользователя сделавшего последнее изменение, её ID и параметр is_deleted = true. |

<a name="events-filter-params"></a>

### Значения для фильтра по значению до/после

В данный момент для фильтра по значению до/после доступны следующие значения:

1.  [leads_statuses](#value_after_before_filter_leads_statuses) - фильтр по статусу сделки, доступен для события lead_status_changed
2.  [customers_statuses](#value_after_before_filter_customers_statuses) - фильтр по статусу покупателя, доступен для события customer_status_changed
3.  [responsible_user_id](#value_after_before_filter_responsible_user_id) - фильтр по ответственному пользователю, доступен для события entity_responsible_changed
4.  [custom_field_values](#value_after_before_filter_custom_field_values) - фильтр по enum значению поля, доступен для события custom_field_{FIELD_ID}_value_changed, в одном запросе должно передаваться не более 1 типа события.
5.  [value](#value_after_before_filter_value) - фильтр по точному значению, доступен для событий nps_rate_added, sale_field_changed, name_field_changed, ltv_field_changed, custom_field_value_changed

<a name="value_after_before_filter_leads_statuses"></a>

##### Описание фильтра по значению до/после - leads_statuses

Данный фильтр позволяет передать ID статусов и их воронок, чтобы получить только необходимые события смены статуса сделки.  
Запрос должен быть составлен следующим образом:  

```

    filter[value_after][leads_statuses][0][pipeline_id]=13513&filter[value_after][leads_statuses][0][status_id]=17079863

```

В примере мы получим все события смены статуса этапа сделки, где сделка перешла в этап 17079863 воронки 13513.  

Вы можете передать несколько значений в фильтр. Ниже приведен пример по формированию такого фильтра используя язык PHP:  

```php

    $filter = [
        'filter' => [
            'value_after' => [
                'leads_statuses' => [
                    [
                        'pipeline_id' => 13513,
                        'status_id' => 17079863,
                    ],
                    [
                        'pipeline_id' => 13513,
                        'status_id' => 17079860,
                    ],
                ],
            ],
        ],
    ];

    $filterUri = http_build_query($filter);

    //filter%5Bvalue_after%5D%5Bleads_statuses%5D%5B0%5D%5Bpipeline_id%5D=13513&filter%5Bvalue_after%5D%5Bleads_statuses%5D%5B0%5D%5Bstatus_id%5D=17079863&filter%5Bvalue_after%5D%5Bleads_statuses%5D%5B1%5D%5Bpipeline_id%5D=13513&filter%5Bvalue_after%5D%5Bleads_statuses%5D%5B1%5D%5Bstatus_id%5D=17079860

```

<a name="value_after_before_filter_customers_statuses"></a>

##### Описание фильтра по значению до/после - customers_statuses

Данный фильтр позволяет передать ID статусов, чтобы получить только необходимые события смены статуса покупателя.  

Запрос должен быть составлен следующим образом:  

```

    filter[value_after][customers_statuses][0][status_id]=135751

```

В примере мы получим все события смены статуса этапа покупателя, где покупатель перешел в этап 135751.  

Вы можете передать несколько значений в фильтр. Ниже приведен пример по формированию такого фильтра используя язык PHP:  

```php

    $filter = [
        'filter' => [
            'value_after' => [
                'customers_statuses' => [
                    [
                        'status_id' => 135751,
                    ],
                    [
                        'status_id' => 135754,
                    ],
                ],
            ],
        ],
    ];

    $filterUri = http_build_query($filter);

    //filter%5Bvalue_after%5D%5Bcustomers_statuses%5D%5B0%5D%5Bstatus_id%5D=135751&filter%5Bvalue_after%5D%5Bcustomers_statuses%5D%5B1%5D%5Bstatus_id%5D=135754

```

<a name="value_after_before_filter_responsible_user_id"></a>

##### Описание фильтра по значению до/после - responsible_user_id

Данный фильтр позволяет передать ID пользователей, состоящих в аккаунте, через запятую, чтобы получить только необходимые события смены ответственного пользователя.  

Запрос должен быть составлен следующим образом:  

```

    filter[value_after][responsible_user_id]=32321

```

В примере мы получим все события смены ответственного пользователя, где ID пользователя 448292.  

Вы можете передать несколько значений в фильтр. Ниже приведен пример по формированию такого фильтра используя язык PHP:  

```php

    $filter = [
        'filter' => [
            'value_after' => [
                'responsible_user_id' => '3231,412314',
            ],
        ],
    ];

    $filterUri = http_build_query($filter);

    //filter%5Bvalue_after%5D%5Bresponsible_user_id%5D=3221%2C412314

```

<a name="value_after_before_filter_custom_field_values"></a>

##### Описание фильтра по значению до/после - custom_field_values

Фильтр по **enum** значению поля, доступен для события custom_field_{FIELD_ID}_value_changed, в одном запросе должно передаваться не более 1 типа события. Данный фильтр позволяет передать **enum** значений поля, чтобы получить только необходимые события изменения значения поля.  

Запрос должен быть составлен следующим образом:  

```

    filter[value_after][custom_field_values]=145&filter[type]=custom_field_57832_value_changed

```

В примере мы получим все события смены значения поля с ID 57832, где ID **enum** равен 145.  

Вы можете передать несколько значений в фильтр. Ниже приведен пример по формированию такого фильтра используя язык PHP:  

```php

    $filter = [
        'filter' => [
            'value_after' => [
                'custom_field_values' => '145,157,202',
            ],
            'type' => 'custom_field_57832_value_changed',
        ],
    ];

    $filterUri = http_build_query($filter);

    filter%5Bvalue_after%5D%5Bcustom_field_values%5D=145%2C157%2C202&filter%5Btype%5D=custom_field_57832_value_changed

```

<a name="value_after_before_filter_value"></a>

##### Описание фильтра по значению до/после - value

Данный фильтр позволяет передать значение до/после. Он работает только со следующими типами событий: nps_rate_added, sale_field_changed, name_field_changed, ltv_field_changed, custom_field_value_changed.  

Запрос должен быть составлен следующим образом:  

```

    filter[value_after][value]=155&filter[type]=sale_field_changed&filter[entity]=lead

```

В примере мы получим все события смены изменения бюджета, где бюджет сделок стал равен 155.  

Ниже приведен пример по формированию такого фильтра используя язык PHP:  

```php
    $filter = [
        'filter' => [
            'value_after' => [
                'value' => '155',
            ],
            'type' => 'sale_field_changed',
            'entity' => 'lead',
        ],
    ];

    $filterUri = http_build_query($filter);

    //filter%5Bvalue_after%5D%5Bvalue%5D=155&filter%5Btype%5D=sale_field_changed&filter%5Bentity%5D=lead
```

<a name="events-params"></a>

### Структуры данных в полях value_after и value_before

Структура данных в полях value\_after и value\_before зависит от типа
события и может принимать разные значения.

-   Тип событий: **lead\_deleted, lead\_restored, contact\_deleted,
contact\_restored, company\_deleted, company\_restored,
customer\_deleted, entity\_merged, task\_added, task\_deleted,
task\_completed**

| Параметр                    | Тип   | Описание      |
|-----------------------------|-------|---------------|
| value\_after\|value\_before | array | Пустой массив |

```json

    {
        "value_after": [],
        "value_before": []
    }

```

-   Тип события: **task\_text\_changed**

| Параметр                                | Тип    | Описание |
|-----------------------------------------|--------|----------|
| value\_after\|value\_before             | array  | Массив с изменениями по событию (у данного типа всегда только одно изменение в массиве) |
| value\_after\|value\_before/0           | object | Объект с данными изменения |
| value\_after\|value\_before/0/task      | object | Объект с данными изменения задачи |
| value\_after\|value\_before/0/task/text | string | Текст задачи |

```json

    {
        "value_after": [
              {
                "task": {
                  "text": "задача"
                }
              }
            ],
        "value_before": [
              {
                "task": {
                  "text": "задача old"
                }
              }
            ],
    }

```

-   Тип событий: **robot\_replied и intent\_identified**

| Параметр                  | Тип    | Описание                                                                                |
|---------------------------|--------|-----------------------------------------------------------------------------------------|
| value\_after              | array  | Массив с изменениями по событию (у данного типа всегда только одно изменение в массиве) |
| value\_after/0            | object | Объект с данными изменения                                                              |
| value\_after/0/helpbot    | object | Объект с данными интента, который сработал                                              |
| value\_after/0/helpbot/id | int    | ID интента                                                                              |

```json

    {
        "value_after": [
              {
                "helpbot": {
                  "id": 145
                }
              }
            ]
    }

```

-   Тип события: **transaction\_added**

| Параметр                      | Тип    | Описание                                                                                |
|-------------------------------|--------|-----------------------------------------------------------------------------------------|
| value\_after                  | array  | Массив с изменениями по событию (у данного типа всегда только одно изменение в массиве) |
| value\_after/0                | object | Объект с данными изменения                                                              |
| value\_after/0/transaction    | object | Объект с данными транзакции                                                             |
| value\_after/0/transaction/id | int    | ID транзакции                                                                           |

```json

    {
        "value_after": [
              {
                "transaction": {
                  "id": 33675
                }
              }
            ]
    }

```
-   Тип событий: **lead\_added, contact\_added, company\_added,
customer\_added, common\_note\_added, common\_note\_deleted,
attachment\_note\_added, targeting\_in\_note\_added,
targeting\_out\_note\_added, geo\_note\_added, service\_note\_added,
site\_visit\_note\_added, message\_to\_cashier\_note\_added,
incoming\_call, outgoing\_call, incoming\_sms, outgoing\_sms,
link\_followed, task\_result\_added**

| Параметр               | Тип    | Описание                                                                                |
|------------------------|--------|-----------------------------------------------------------------------------------------|
| value\_after           | array  | Массив с изменениями по событию (у данного типа всегда только одно изменение в массиве) |
| value\_after/0         | object | Объект с данными изменения                                                              |
| value\_after/0/note    | object | Объект с данными примечания                                                             |
| value\_after/0/note/id | int    | ID примечания                                                                           |

```json

    {
        "value_after": [
              {
                "note": {
                  "id": 7422564
                }
              }
            ]
    }

```

-   Тип события: **nps\_rate\_added**

| Параметр                | Тип    | Описание                                                                                |
|-------------------------|--------|-----------------------------------------------------------------------------------------|
| value\_after            | array  | Массив с изменениями по событию (у данного типа всегда только одно изменение в массиве) |
| value\_after/0          | object | Объект с данными изменения                                                              |
| value\_after/0/nps      | object | Объект с данными оценки                                                                 |
| value\_after/0/nps/rate | int    | Оценка от 0 до 10                                                                       |

```json

    {
        "value_after": [
              {
                "nps": {
                  "rate": 7
                }
              }
            ]
    }

```

-   Тип событий: **incoming\_chat\_message и outgoing\_chat\_message**

| Параметр                  | Тип    | Описание                                                                                |
|---------------------------|--------|-----------------------------------------------------------------------------------------|
| value\_after              | array  | Массив с изменениями по событию (у данного типа всегда только одно изменение в массиве) |
| value\_after/0            | object | Объект с данными изменения                                                              |
| value\_after/0/message    | object | Объект с данными сообщения                                                              |
| value\_after/0/message/id | string | ID сообщения                                                                            |

```json

    {
        "value_after": [
              {
                "message": {
                  "id": "1508b51c-aab0-428e-9322-611d847ae747"
                }
              }
            ]
    }

```

-   Тип событий: **entity\_tag\_added и entity\_tag\_deleted**

| Параметр                               | Тип    | Описание                        |
|----------------------------------------|--------|---------------------------------|
| value\_after\|value\_before            | array  | Массив с изменениями по событию |
| value\_after\|value\_before/0          | object | Объект с данными изменения      |
| value\_after\|value\_before/0/tag      | object | Объект с данными тега           |
| value\_after\|value\_before/0/tag/name | string | Название тега                   |

```json

    {
        "value_after": [
              {
                "tag": {
                  "name": "тег1"
                }
              }
            ],
        "value_before": [
              {
                "tag": {
                  "name": "тег2"
                }
              },
              {
                "tag": {
                  "name": "тег2"
                }
              }
            ]
    }

```

-   Тип события: **lead\_status\_changed**

| Параметр                                                | Тип    | Описание                        |
|---------------------------------------------------------|--------|---------------------------------|
| value\_after\|value\_before                             | array  | Массив с изменениями по событию |
| value\_after\|value\_before/0                           | object | Объект с данными изменения (у данного типа всегда только одно изменение в массиве) |
| value\_after\|value\_before/0/lead\_status              | object | Объект с данными статуса |
| value\_after\|value\_before/0/lead\_status/id           | int    | ID статуса |
| value\_after\|value\_before/0/lead\_status/pipeline\_id | int    | ID воронки |

```json

    {
        "value_after": [
              {
                "lead_status": {
                  "id": 5233224,
                  "pipeline_id": 437642,
                }
              }
            ],
        "value_before": [
              {
                "lead_status": {
                  "id": 5233224,
                  "pipeline_id": 437642,
                }
              }
            ]
    }

```

-   Тип события: **customer\_status\_changed**

| Параметр                                          | Тип    | Описание              |
|---------------------------------------------------|--------|-----------------------|
| value\_after\|value\_before                       | array  | Массив с изменениями по событию |
| value\_after\|value\_before/0                     | object | Объект с данными изменения (у данного типа всегда только одно изменение в массиве) |
| value\_after\|value\_before/0/customer\_status    | object | Объект с данными статуса |
| value\_after\|value\_before/0/customer\_status/id | int    | ID статуса |

```json

    {
        "value_after": [
              {
                "customer_status": {
                  "id": 43832
                }
              }
            ],
        "value_before": [
              {
                "customer_status": {
                  "id": 53791
                }
              }
            ]
    }

```

-   Тип событий: **customer\_linked, customer\_unlinked,
company\_linked, company\_unlinked, contact\_linked,
contact\_unlinked, lead\_linked, lead\_unlinked, entity\_linked,
entity\_unlinked**

| Параметр                                               | Тип    | Описание |
|--------------------------------------------------------|--------|----------|
| value\_after\|value\_before                            | array  | Массив с изменениями по событию (у данного типа всегда только одно изменение в массиве) |
| value\_after\|value\_before/0                          | object | Объект с данными изменения |
| value\_after\|value\_before/0/link\|unlink             | object | Объект с данными cобытия |
| value\_after\|value\_before/0/link\|unlink/entity      | object | Объект с сущностью |
| value\_after\|value\_before/0/link\|unlink/entity/type | string | Тип сущности |
| value\_after\|value\_before/0/link\|unlink/entity/id   | int    | ID сущности |

```json

    {
        "value_after": [
              {
                "link": {
                  "entity": {
                    "type": "lead",
                    "id": 6232965
                  }
                }
              }
            ],
        "value_before": []
    }

```

-   Тип события: **entity\_responsible\_changed**

| Параметр                                           | Тип    | Описание |
|----------------------------------------------------|--------|----------|
| value\_after\|value\_before                        | array  | Массив с изменениями по событию |
| value\_after\|value\_before/0                      | object | Объект с данными изменения (у данного типа всегда только одно изменение в массиве) |
| value\_after\|value\_before/0/responsible\_user    | object | Объект с данными пользователя |
| value\_after\|value\_before/0/responsible\_user/id | int    | ID пользователя |

```json

    {
        "value_after": [
              {
                "responsible_user": {
                  "id": 504329
                }
              }
            ],
        "value_before": [
              {
                "responsible_user": {
                  "id": 37268
                }
              }
            ]
    }

```

-   Тип события: **task\_deadline\_changed**

| Параметр                                               | Тип    | Описание                         |
|--------------------------------------------------------|--------|----------------------------------|
| value\_after\|value\_before                            | array  | Массив с изменениями по событию  |
| value\_after\|value\_before/0 | object | Объект с данными изменения (у данного типа всегда только одно изменение в массиве) |
| value\_after\|value\_before/0/task\_deadline           | object | Объект с данными срока выполнения задачи |
| value\_after\|value\_before/0/task\_deadline/timestamp | int    | Timestamp срока выполнения задачи |

```json

    {
        "value_after": [
              {
                "task_deadline": {
                  "timestamp": 1573595900
                }
              }
            ],
        "value_before": [
              {
                "task_deadline": {
                  "timestamp": 1573578700
                }
              }
            ]
    }

```

-   Тип события: **task\_type\_changed**

| Параметр                                    | Тип    | Описание            |
|---------------------------------------------|--------|---------------------|
| value\_after\|value\_before                 | array  | Массив с изменениями по событию |
| value\_after\|value\_before/0 | object | Объект с данными изменения (у данного типа всегда только одно изменение в массиве) |
| value\_after\|value\_before/0/task\_type    | object | Объект с данными типа задачи  |
| value\_after\|value\_before/0/task\_type/id | int    | ID типа задачи |

```json

    {
        "value_after": [
              {
                "task_type": {
                  "id": 504329
                }
              }
            ],
        "value_before": [
              {
                "task_type": {
                  "id": 37268
                }
              }
            ]
    }

```

-   Тип события: **custom\_field\_value\_changed**

| Параметр                                                       | Тип       | Описание |
|----------------------------------------------------------------|-----------|----------|
| value\_after\|value\_before                                    | array     | Массив с изменениями по событию |
| value\_after\|value\_before/0                                  | object    | Объект с данными изменения |
| value\_after\|value\_before/0/custom\_field\_value             | object    | Объект с данными изменения поля |
| value\_after\|value\_before/0/custom\_field\_value/field\_id   | int       | ID измененого поля |
| value\_after\|value\_before/0/custom\_field\_value/field\_type | int       | Тип измененного поля |
| value\_after\|value\_before/0/custom\_field\_value/enum\_id    | int\|null | ID enum значения поля, null, если у поля нет enum значений |
| value\_after\|value\_before/0/custom\_field\_value/text        | string    | Текст значения поля |

```json

    {
      "value_after": [
        {
          "custom_field_value": {
            "field_id": 53728,
            "field_type": 8,
            "enum_id": 2352876,
            "text": "example1@test.com"
          }
        },
        {
          "custom_field_value": {
            "field_id": 53728,
            "field_type": 8,
            "enum_id": 2352876,
            "text": "example@test.com"
          }
        }
      ],
      "value_before": [
        {
          "custom_field_value": {
            "field_id": 53728,
            "field_type": 8,
            "enum_id": 193200,
            "text": "example@test.com"
          }
        }
      ]
    }

```


<a name="events-types"></a>

### Типы событий

#### Возможные типы событий

| Значение                                   | Описание                   |
|--------------------------------------------|----------------------------|
| lead\_added                                | Новая сделка               |
| lead\_deleted                              | Сделка удалена             |
| lead\_restored                             | Сделка восстановлена       |
| lead\_status\_changed                      | Изменение этапа продажи    |
| lead\_linked                               | Прикрепление сделки        |
| lead\_unlinked                             | Открепление сделки         |
| contact\_added                             | Новый контакт              |
| contact\_deleted                           | Контакт удален             |
| contact\_restored                          | Контакт восстановлен       |
| contact\_linked                            | Прикрепление контакта      |
| contact\_unlinked                          | Открепление контакта       |
| company\_added                             | Новая компания             |
| company\_deleted                           | Компания удалена           |
| company\_restored                          | Компания восстановлена     |
| company\_linked                            | Прикрепление компании      |
| company\_unlinked                          | Открепление компании       |
| customer\_added                            | Новый покупатель           |
| customer\_deleted                          | Покупатель удален          |
| customer\_status\_changed                  | Изменение этапа покупателя |
| customer\_linked                           | Прикрепление покупателя    |
| customer\_unlinked                         | Открепление покупателя     |
| task\_added                                | Новая задача               |
| task\_deleted                              | Задача удалена             |
| task\_completed                            | Завершение задачи          |
| task\_type\_changed                        | Изменение типа задачи      |
| task\_text\_changed                        | Изменение текста задачи    |
| task\_deadline\_changed                    | Изменение даты исполнения задачи|
| task\_result\_added                        | Результат по задаче        |
| incoming\_call                             | Входящий звонок            |
| outgoing\_call                             | Исходящий звонок           |
| incoming\_chat\_message                    | Входящее сообщение         |
| outgoing\_chat\_message                    | Исходящее сообщение        |
| incoming\_sms                              | Входящее SMS               |
| outgoing\_sms                              | Исходящее SMS              |
| entity\_tag\_added                         | Теги добавлены             |
| entity\_tag\_deleted                       | Теги убраны                |
| entity\_linked                             | Прикрепление               |
| entity\_unlinked                           | Открепление                |
| sale\_field\_changed                       | Изменение поля “Бюджет”    |
| name\_field\_changed                       | Изменение поля “Название”  |
| ltv\_field\_changed                        | Сумма покупок              |
| custom\_field\_value\_changed              | Изменение поля             |
| entity\_responsible\_changed               | Ответственный изменен      |
| robot\_replied                             | Ответ робота               |
| intent\_identified                         | Тема вопроса определена    |
| nps\_rate\_added                           | Новая оценка NPS           |
| link\_followed                             | Переход по ссылке          |
| transaction\_added                         | Добавлена покупка          |
| common\_note\_added                        | Новое примечание           |
| common\_note\_deleted                      | Примечание удалено         |
| attachment\_note\_added                    | Добавлен новый файл        |
| targeting\_in\_note\_added                 | Добавление в ретаргетинг   |
| targeting\_out\_note\_added                | Удаление из ретаргетинга   |
| geo\_note\_added                           | Новое примечание с гео-меткой |
| service\_note\_added                       | Новое системное примечание |
| site\_visit\_note\_added                   | Заход на сайт              |
| message\_to\_cashier\_note\_added          | LifePay: Сообщение кассиру |
| key\_action\_completed                     | Ключевое действие          |
| entity\_merged                             | Выполнено объединение      |
| custom\_field\_{FIELD\_ID}\_value\_changed | Изменение поля c переданным ID. Если вы передаете данный тип, то другие типы не могут быть переданы. |



<a name="event-types"></a>

### Получение типов событий

#### Метод

*GET /api/v4/events/types*

#### Описание 

Метод позволяет получить все доступные для аккаунта типы событий.

#### Ограничения 

Метод доступен всем пользователям аккаунта. Возвращаемые данные зависят от прав на сущность.

#### GET параметры 


| Параметр | Тип данных | Описание |
|--|--|--|
| language_code | string | Код языка, в котором вернутся названия типов событий. Если не передан, то вернется в языке пользователя, под которым происходит запрос. Возможные параметры – en, es, ru, pt. |

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке 

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|
| 200 | Запрос выполнен успешно |
| 401 | Пользователь не авторизован |
| 402 | Аккаунт не оплачен |

#### Параметры ответа 

Метод возвращает коллекцию моделей типов событий, рассмотрим ниже свойства.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|key|string|Код типа события|
|type|int|Идентификатор типа события|
|lang|string|Локализованное название события|

#### Пример ответа 

```json

{
    "_total_items": 35,
    "_links": {
        "self": {
            "href": "https://example.amocrm.ru/api/v4/events/types?limit=6"
        }
    },
    "_embedded": {
        "events_types": [
            {
                "key": "lead_added",
                "type": 1,
                "lang": "Новая сделка"
            },
            {
                "key": "lead_deleted",
                "type": 7,
                "lang": "Сделка удалена"
            },
            ...
        ]
    }
}

```

<a name="notes-common-info"></a>

### Общая информация о примечаниях

Примечания предоставляют возможность хранить дополнительную структурированную или неструктурированную информацию к сущности. Примечания отображаются в виде событий в карточке сущности. Они могут быть добавлены к следующим сущностям: сделка, контакт, компания и покупатель. Чаще всего примечания используются виджетами для добавления дополнительной информации, которая имеет привязку ко времени. Они всегда отображаются в хронологическом порядке в ленте и, если ваша информация привязана к дате (хронологии), то мы рекомендуем использовать именно примечания. Примечания бывают разных типов: системные (исходящее/входящее смс, исходящий/входящий звонок, счет оплачен, контакт создан и т.д.), созданные пользователем (текстовые примечания, файлы). В amoCRM существует 10 типов примечаний, которые можно редактировать.

<a name="notes-types"></a>

### Типы примечаний

#### Возможные типы примечаний

| Тип                        | Название                                                                                  |
|----------------------------|-------------------------------------------------------------------------------------------|
| common                     | Текстовое примечание                                                                      |
| call\_in                   | Входящий звонок                                                                           |
| call\_out                  | Исходящий звонок                                                                          |
| service\_message           | Системное сообщение (добавляется интеграциями)                                            |
| message\_cashier           | Сообщение кассиру                                                                         |
| geolocation                | Текстовое примечание с гео-координатами (добавляются мобильным приложением)               |
| sms\_in                    | Входящее SMS                                                                              |
| sms\_out                   | Исходящее SMS                                                                             |
| extended\_service\_message | Расширенное системное сообщение (поддерживает больше текста и сворачивается в интерфейсе) |

<a name="notes-params-info"></a>

#### Типы примечаний, для которых обязателен массив params

```json

    Тип примечания - common

    "params": {
       "text": "Обычное примечание"
    }

    Тип примечания - call_in

    "params": {
       "uniq": "8f52d38a-5fb3-406d-93a3-a4832dc28f8b",
       "duration": 60,
       "source": "onlinePBX",
       "link": "https://example.com",
       "phone": "+79999999999"
    }

    Тип примечания - call_out

    "params": {
       "uniq": "8f52d38a-5fb3-406d-93a3-a4832dc28f8b",
       "duration": 60,
       "source": "onlinePBX",
       "link": "https://example.com",
       "phone": "+79999999999"
    }

    Тип примечания - service_message и extended_service_message

    "params": {
       "service": "Сервис для примера",
       "text": "Текст для примечания"
    }

    Тип примечания - message_cashier

    "params": {
        // Статус может быть один из следующих:
        // - created
        // - shown
        // - canceled
        "status": "created",
        "text": "Текст для примечания"
    }

    Тип примечания - geolocation

    "params": {
       "text": "Геолокация",
       "address": "ул. Пушкина, дом Колотушкина",
       // долгота
       "longitude": "-13",
       // широта
       "latitude": "32"
    }

    Тип примечания - sms_in

    "params": {
      "text": "Новое входящие сообщение",
      "phone": "+79999999999"
    }

    Тип примечания - sms_out

    "params": {
       "text": "Новое исходящие сообщение",
       "phone": "+79999999999"
    }

```


<a name="notes-list"></a>

### Список примечаний по типу сущности

#### Метод

*GET /api/v4/{entity_type}/notes*

#### Описание 

Метод позволяет получить примечания по типу сущности.

#### Ограничения 

Метод доступен всем пользователям аккаунта. Возвращаемые данные зависят от прав на сущность.

#### GET параметры 


| Параметр | Тип данных | Описание |
|--|--|--|
| page | int | Страница выборки |
| limit | int | Количество возвращаемых сущностей за один запрос (Максимум – 250) |
| filter | object | Фильтр |
| filter[id] | int|array | Фильтр по ID примечаний. Можно передать как один ID, так и массив из нескольких ID |
| filter[entity_id] | array | Фильтр по ID примечаний. Можно передать массив из нескольких ID |
| filter[note_type] | string|array | Фильтр по типу примечания. |
| filter[updated_at] | int|object | Фильтр по дате последнего изменения примечания.
Можно передать timestamp, в таком случае будут возвращены примечания, которые были изменены после переданного значения.
Также можно передать массив вида filter[updated_at][from]=… и filter[updated_at][to]=…, для фильтрации по значениям ОТ и ДО. |
| order | object | Сортировка результатов списка.
Доступные поля для сортировки: updated_at, id.
Доступные значения для сортировки: asc, desc.
Пример: /api/v4/leads/notes?order[updated_at]=asc |

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке 

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|
| 200 | Запрос выполнен успешно |
| 401 | Пользователь не авторизован |
| 402 | Аккаунт не оплачен |

#### Параметры ответа 

Метод возвращает коллекцию моделей примечаний, рассмотрим ниже свойства примечаний.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|id|int|ID примечания|
|entity_id|int|ID родительской сущности примечания|
|created_by|int|ID пользователя, создавший примечание|
|updated_by|int|ID пользователя, изменивший примечание последним|
|created_at|int|Дата создания примечания, передается в Unix Timestamp|
|updated_at|int|Дата изменения примечания, передается в Unix Timestamp|
|responsible_user_id|int|ID пользователя, ответственного за примечание|
|group_id|int|ID группы, в которой состоит ответственны пользователь за примечание|
|note_type|string|Тип примечания|
|params|object|Свойства примечания, зависят от типа примечания. Подробней о свойствах читайте <a href="#notes-params-info">тут</a>|
|account_id|int|ID аккаунта, в котором находится примечание|

#### Пример ответа 

```json

{
    "_page": 1,
    "_links": {
        "self": {
            "href": "https://example.amocrm.ru/api/v4/leads/notes?filter%5Bid%5D%5B0%5D=42709325&filter%5Bid%5D%5B1%5D=42709842&page=1&limit=50"
        },
        "next": {
            "href": "https://example.amocrm.ru/api/v4/leads/notes?filter%5Bid%5D%5B0%5D=42709325&filter%5Bid%5D%5B1%5D=42709842&page=2&limit=50"
        }
    },
    "_embedded": {
        "notes": [
            {
                "id": 42709325,
                "entity_id": 26050861,
                "created_by": 940088,
                "updated_by": 940088,
                "created_at": 1540407495,
                "updated_at": 1540408317,
                "responsible_user_id": 939801,
                "group_id": 0,
                "note_type": "common",
                "params": {
                    "text": "Текст примечания"
                },
                "account_id": 17079858,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/26050861/notes/42709325"
                    }
                }
            },
            {
                "id": 42709842,
                "entity_id": 26053794,
                "created_by": 939801,
                "updated_by": 939801,
                "created_at": 1548280113,
                "updated_at": 1548280115,
                "responsible_user_id": 939801,
                "group_id": 0,
                "note_type": "attachment",
                "params": {
                    "original_name": "Снимок экрана 2020-05-16 в 13.12.20.png",
                    "attachment": "gijy_Snimok_ekrana_2020-05-16_v_13.12.20.png"
                },
                "account_id": 17079858,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/26053794/notes/42709842"
                    }
                }
            }
        ]
    }
}

```

<a name="notes-entity-list"></a>

### Список примечаний по конкретной сущности, по ID сущности

#### Метод

*GET /api/v4/{entity_type}/{entity_id}/notes*

#### Описание 

Метод позволяет получить примечания по ID родительской сущности.

#### Ограничения 

Метод доступен всем пользователям аккаунта. Возвращаемые данные зависят от прав на сущность.

#### GET параметры 


| Параметр | Тип данных | Описание |
|--|--|--|
| page | int | Страница выборки |
| limit | int | Количество возвращаемых сущностей за один запрос (Максимум – 250) |
| filter | object | Фильтр |
| filter[id] | int|array | Фильтр по ID примечаний. Можно передать как один ID, так и массив из нескольких ID |
| filter[note_type] | string|array | Фильтр по типу примечания. |
| filter[updated_at] | int|object | Фильтр по дате последнего изменения примечания.
Можно передать timestamp, в таком случае будут возвращены примечания, которые были изменены после переданного значения.
Также можно передать массив вида filter[updated_at][from]=… и filter[updated_at][to]=…, для фильтрации по значениям ОТ и ДО. |
| order | object | Сортировка результатов списка.
Доступные поля для сортировки: updated_at, id.
Доступные значения для сортировки: asc, desc.
Пример: /api/v4/leads/notes?order[updated_at]=asc |

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке 

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|
| 200 | Запрос выполнен успешно |
| 401 | Пользователь не авторизован |
| 402 | Аккаунт не оплачен |

#### Параметры ответа 

Метод возвращает коллекцию моделей примечаний, рассмотрим ниже свойства примечаний.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|id|int|ID примечания|
|entity_id|int|ID родительской сущности примечания|
|created_by|int|ID пользователя, создавший примечание|
|updated_by|int|ID пользователя, изменивший примечание последним|
|created_at|int|Дата создания примечания, передается в Unix Timestamp|
|updated_at|int|Дата изменения примечания, передается в Unix Timestamp|
|responsible_user_id|int|ID пользователя, ответственного за примечание|
|group_id|int|ID группы, в которой состоит ответственны пользователь за примечание|
|note_type|string|Тип примечания|
|params|object|Свойства примечания, зависят от типа примечания. Подробней о свойствах читайте <a href="#notes-params-info">тут</a>|
|account_id|int|ID аккаунта, в котором находится примечание|

#### Пример ответа 

```json

{
    "_page": 1,
    "_links": {
        "self": {
            "href": "https://example.amocrm.ru/api/v4/leads/26050861/notes?limit=2&page=1"
        },
        "next": {
            "href": "https://example.amocrm.ru/api/v4/leads/26050861/notes?limit=2&page=2"
        }
    },
    "_embedded": {
        "notes": [
            {
                "id": 42709325,
                "entity_id": 26050861,
                "created_by": 940088,
                "updated_by": 940088,
                "created_at": 1540407495,
                "updated_at": 1540408317,
                "responsible_user_id": 939801,
                "group_id": 0,
                "note_type": "common",
                "params": {
                    "text": "Текст примечания 2"
                },
                "account_id": 17079858,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/26050861/notes/42709325"
                    }
                }
            },
            {
                "id": 42736075,
                "entity_id": 26050861,
                "created_by": 939801,
                "updated_by": 939801,
                "created_at": 1587555198,
                "updated_at": 1587555199,
                "responsible_user_id": 939801,
                "group_id": 0,
                "note_type": "common",
                "params": {
                    "text": "Текст примечания"
                },
                "account_id": 17079858,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/26050861/notes/42736075"
                    }
                }
            }
        ]
    }
}

```

<a name="note-detail"></a>

### Получение примечания по ID

#### Метод

*GET /api/v4/{entity_type}/notes/{id}*

*GET /api/v4/{entity_type}/{entity_id}/notes/{id}*

#### Описание 

Метод позволяет получить данные конкретного примечания по ID.

#### Ограничения 

Метод доступен всем пользователям аккаунта. Возвращаемые данные зависят от прав на сущность.

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке 

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|
| 200 | Запрос выполнен успешно |
| 401 | Пользователь не авторизован |
| 402 | Аккаунт не оплачен |

#### Параметры ответа 

Метод возвращает модель примечания, рассмотрим ниже свойства примечания.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|id|int|ID примечания|
|entity_id|int|ID родительской сущности примечания|
|created_by|int|ID пользователя, создавший примечание|
|updated_by|int|ID пользователя, изменивший примечание последним|
|created_at|int|Дата создания примечания, передается в Unix Timestamp|
|updated_at|int|Дата изменения примечания, передается в Unix Timestamp|
|responsible_user_id|int|ID пользователя, ответственного за примечание|
|group_id|int|ID группы, в которой состоит ответственны пользователь за примечание|
|note_type|string|Тип примечания|
|params|object|Свойства примечания, зависят от типа примечания. Подробней о свойствах читайте <a href="#notes-params-info">тут</a>|
|account_id|int|ID аккаунта, в котором находится примечание|

#### Пример ответа 

```json

{
    "id": 42709325,
    "entity_id": 26050861,
    "created_by": 940088,
    "updated_by": 940088,
    "created_at": 1540407495,
    "updated_at": 1540408317,
    "responsible_user_id": 939801,
    "group_id": 0,
    "note_type": "common",
    "params": {
        "text": "Текст примечания"
    },
    "account_id": 17079858,
    "_links": {
        "self": {
            "href": "https://example.amocrm.ru/api/v4/leads/26050861/notes/42709325"
        }
    }
}

```

<a name="notes-add"></a>

### Добавление примечаний

#### Метод

*POST /api/v4/{entity_type}/notes*

*POST /api/v4/{entity_type}/{entity_id}/notes*

#### Описание 

Метод позволяет добавлять примечания в аккаунт пакетно.

#### Ограничения 

Метод доступен всем пользователям аккаунта. Успешность выполнения действия зависит от прав на сущность.

#### Заголовок запроса 

*Content-Type: application/json*

#### Параметры запроса 




| Параметр | Тип данных | Описание |
|--|--|--|
| entity_id | int | ID сущности, в которую добавляется примечание. Обязателен при использовании метода создания примечания в сущности, если создание идет через метод /api/v4/{entity_type}/{entity_id}/notes, то данный параметр передавать не нужно |
| created_by | int | ID пользователя, от имени которого добавляется примечание. При добавлении звонка, в таймлайне карточки, пользователь будет отображен как автор звонка или как принимающий, в зависимости от типа звонка |
| note_type | string | Тип примечания. <a href="#notes-types">Возможные типы примечаний</a> |
| params | object | Свойства примечания, зависят от типа примечания. Подробней о свойствах читайте <a href="#notes-params-info">тут</a> |
| request_id | string | Поле, которое вернется вам в ответе без изменений и не будет сохранено. Необязательный параметр |

#### Пример запроса



```

[
    {
        "entity_id": 167353,
        "note_type": "call_in",
        "params": {
            "uniq": "8f52d38a-5fb3-406d-93a3-a4832dc28f8b",
            "duration": 60,
            "source": "onlinePBX",
            "link": "https://example.com",
            "phone": "+79999999999"
        }
    },
    {
        "entity_id": 167353,
        "note_type": "call_out",
        "params": {
            "uniq": "8f52d38a-5fb3-406d-93a3-a4832dc28f8b",
            "duration": 60,
            "source": "onlinePBX",
            "link": "https://example.com",
            "phone": "+79999999999"
        }
    },
    {
        "entity_id": 167353,
        "note_type": "geolocation",
        "params": {
            "text": "Примечание с геолокацией",
            "address": "ул. Пушкина, дом Колотушкина, квартира Вольнова",
            "longitude": "53.714816",
            "latitude": "91.423146"
        }
    }
]

```

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке 

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|
| 200 | Примечания были успешно созданы |
| 403 | Не хватает прав для вызова данного метода |
| 401 | Пользователь не авторизован |
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа |

#### Параметры ответа 

Метод возвращает коллекцию примечаний, которые были созданы.

| Параметр | Тип данных | Описание |
|----------|------------|----------|
|id|int|ID примечания|
|entity_id|int|ID сущности, в которое было добавлено примечание|
|request_id|string|Строка переданная при запросе или порядковый указатель, если параметр не передан|

#### Пример ответа 

```json

{
    "_links": {
        "self": {
            "href": "http://example.amocrm.ru/api/v4/leads/notes"
        }
    },
    "_embedded": {
        "notes": [
            {
                "id": 76787983,
                "entity_id": 167353,
                "request_id": "0",
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/167353/notes/76787983"
                    }
                }
            },
            {
                "id": 76787985,
                "entity_id": 167353,
                "request_id": "1",
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/167353/notes/76787985"
                    }
                }
            },
            {
                "id": 76787987,
                "entity_id": 167353,
                "request_id": "2",
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/167353/notes/76787987"
                    }
                }
            },
            {
                "id": 76787989,
                "entity_id": 167353,
                "request_id": "3",
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/167353/notes/76787989"
                    }
                }
            }
        ]
    }
}

```

<a name="notes-edit"></a>

### Редактирование примечаний

#### Метод

*PATCH /api/v4/{entity_type}/notes*

*PATCH /api/v4/{entity_type}/{entity_id}/notes*

*PATCH /api/v4/{entity_type}/{entity_id}/notes/{id}*

#### Описание 

Метод позволяет редактировать примечания пакетно.
Также вы можете добавить ID примечания в метод для редактирования конкретного примечания (/api/v4/{entity_type}/{entity_id}/notes/{id}).
При редактировании пакетно передается массив из объектов-примечаний, при редактировании одного примечания, передается просто модель.

#### Ограничения 

Метод доступен всем пользователям аккаунта. Успешность выполнения действия зависит от прав на сущность.

#### Заголовок запроса 

*Content-Type: application/json*

#### Параметры запроса 




| Параметр | Тип данных | Описание |
|--|--|--|
| entity_id | int | ID сущности, в которую добавляется примечание. Обязателен при использовании метода создания примечания в сущности, если создание идет через метод /api/v4/{entity_type}/{entity_id}/notes, то данный параметр передавать не нужно |
| note_type | string | Тип примечания. <a href="#notes-types">Возможные типы примечаний</a> |
| params | object | Свойства примечания, зависят от типа примечания. Подробней о свойствах читайте <a href="#notes-params-info">тут</a> |

#### Пример запроса



```

[
    {
        "id": 76610421,
        "note_type": "sms_in",
        "params": {
            "text": "Новое входящие SMS",
            "phone": "+79999999999"
        }
    },
    {
        "id": 76610423,
        "note_type": "sms_out",
        "params": {
            "text": "Новое исходящие SMS",
            "phone": "+79999999999"
        }
    }
]


```

#### Заголовок типа данных при успешном результате

*Content-Type: application/hal+json*

#### Заголовок типа данных при ошибке 

*Content-Type: application/problem+json*

#### HTTP коды ответа

| Код ответа | Условие |
|------------|---------|
| 200 | Списки были успешно изменены |
| 401 | Пользователь не авторизован |
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа |

#### Параметры ответа 

Метод возвращает коллекцию или модель списка, которые были изменены. Параметры аналогичны тем, что возвращаются при создании примечания.

#### Пример ответа 

```json

{
    "_links": {
        "self": {
            "href": "https://example.amocrm.ru/api/v4/leads/notes"
        }
    },
    "_embedded": {
        "notes": [
            {
                "id": 76610421,
                "entity_id": 167353,
                "updated_at": 1588841241,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/167353/notes/76610421"
                    }
                }
            },
            {
                "id": 76610423,
                "entity_id": 167353,
                "updated_at": 1588841241,
                "_links": {
                    "self": {
                        "href": "https://example.amocrm.ru/api/v4/leads/167353/notes/76610423"
                    }
                }
            }
        ]
    }
}

```
<!-- Generated at Tue, 02 Mar 2021 14:45:14 +0000. amoCRM Documentation Generator -->